
#!/bin/bash

# Exercise:
#Create 3 groups â€“ admin, support & engineering and add the admin group to sudoers. 
#Create a user in each of the groups. 
#Generate SSH keys for the user in the admin group.

#Instruction:
#Submit the contents of /etc/passwd, /etc/group, /etc/sudoers

# Function to create groups
create_groups() {
    echo "Comment: Creating groups: testadmin, testsupport, testengineering"
    sudo groupadd testadmin
    sudo groupadd testsupport
    sudo groupadd testengineering
}

# Function to create users and add them to respective groups (no passwords required)
create_users() {
    echo "Comment: Creating users: testmariam_admin, testmariam_support, testmariam_engineering"
    sudo useradd -m -G testadmin testmariam_admin
    sudo useradd -m -G testsupport testmariam_support
    sudo useradd -m -G testengineering testmariam_engineering
}

# Ensure admin is a sudoer (assuming this is already set in /etc/sudoers)
check_sudoers() {
    echo "Ensuring testmariam_admin is a sudoer"
    sudo grep '^%admin' /etc/sudoers || echo "%admin ALL=(ALL:ALL) ALL" | sudo EDITOR="tee -a" visudo
}

# Function to list RSA files
list_rsa_files() {
    echo "Listing RSA keys for testmariam_admin"
    if [ -d /home/testmariam_admin/.ssh ]; then
        ls -al /home/testmariam_admin/.ssh
    else
        echo "No RSA key directory found for testmariam_admin"
    fi
}

# Function to display results (contents of /etc/passwd, /etc/group, /etc/sudoers)
show_results() {
    echo "### Contents of /etc/group ###"
    cat /etc/group | grep 'admin\|support\|engineering'

    echo "### Contents of /etc/passwd ###"
    cat /etc/passwd | grep 'testmariam_admin\|mariam_support\|mariam_engineering'

    echo "### Sudoers Entry for admin group ###"
    sudo cat /etc/sudoers | grep admin

    # List RSA key files for mariam_admin
    list_rsa_files
}

# Main function to run the assignment
run_assignment() {
    create_groups
    create_users
    check_sudoers
    show_results
}

# Run the assignment function
run_assignment
